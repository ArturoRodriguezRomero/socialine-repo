<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="shortcut icon" href="assets/favicon.png" />
  <title>Socialine</title>
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <div class="app-wrapper">
    <div id="app">
      <div class="main-panel" v-if="client != null">
        <div class="sidebar">
          <div class="sidebar-header">
            <div class="item">
              <div class="client-picture" v-bind:style="{'background-image': 'url(' + client.pictureUrl + ')'}"></div>
              <div class="client-body">
                <div class="client-name">{{client.name}}</div>
                <div class="client-about">{{client.about}}</div>
              </div>
            </div>
            <div class="item">
              <div class="client-modify" v-on:click="toggleSlidingPanel('sliding-panel')">
                <i class="fas fa-bars"></i>
              </div>
            </div>
          </div>
          <div class="sidebar-body">
            <div class="user-list scrollbar">
              <div class="user-item" v-for="user in users" v-if="user._id != client._id && kmBetweenLocations(client.latitude, user.latitude, client.longitude, user.longitude) < client.maxKmDistance"
                v-on:click="selectUser(user)" v-bind:class="[user._id == selectedUser._id ? 'selected': '']">
                <div class="user-picture" v-bind:style="{'background-image' : 'url(' + user.pictureUrl +')'}"></div>
                <div class="user-body">
                  <div class="user-name">{{user.name}}</div>
                  <div class="user-about">{{user.about}}</div>
                </div>
                <div class="user-new-message"></div>
              </div>
            </div>
          </div>
          <div class="sliding-panel">
            <div class="sliding-header">
              <div class="panel-title">Settings</div>
              <div class="close-panel" v-on:click="toggleSlidingPanel('sliding-panel'); saveClientUser();">
                <i class="fas fa-save"></i>
              </div>
            </div>
            <div class="sliding-body scrollbar">
              <div class="client-picture" v-bind:style="{'background-image': 'url(' + client.pictureUrl + ')'}"></div>
              <div class="input-wrapper">
                <div class="input-title">Image</div>
                <div class="input-row">
                  <input class="textbox" type="text" name="" id="sliderImageInput" v-model="client.pictureUrl">
                  <div class="action-button" v-on:click="focusInput('sliderImageInput')">
                    <i class="fas fa-pencil-alt"></i>
                  </div>
                </div>
              </div>
              <div class="input-wrapper">
                <div class="input-title">Name</div>
                <div class="input-row">
                  <input class="textbox" type="text" name="" id="sliderNameInput" v-model="client.name">
                  <div class="action-button" v-on:click="focusInput('sliderNameInput')">
                    <i class="fas fa-pencil-alt"></i>
                  </div>
                </div>
              </div>
              <div class="input-wrapper">
                <div class="input-title">About</div>
                <div class="input-row">
                  <input class="textbox" type="text" name="" id="sliderAboutInput" v-model="client.about">
                  <div class="action-button" v-on:click="focusInput('sliderAboutInput')">
                    <i class="fas fa-pencil-alt"></i>
                  </div>
                </div>
              </div>
              <div class="input-wrapper">
                <div class="input-title">Max distance</div>
                <div class="input-row">
                  <input class="textbox" type="range" name="" id="sliderMaxDistanceInput" v-model="client.maxKmDistance" min="1" max="15">
                  <div class="input-value">
                    {{client.maxKmDistance}}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="chat-wrapper">
          <div class="chat-header">
            <div class="hide-chat" v-on:click="hideChat">
              <i class="fas fa-angle-left"></i>
            </div>
            <div class="receiver-picture" v-bind:style="{ 'background-image': 'url(' + selectedUser.pictureUrl + ')' }"></div>
            <div class="receiver-body">
              <div class="receiver-name">{{selectedUser.name}}</div>
              <div class="receiver-last-connection">{{selectedUser.lastConnection}}</div>
            </div>
          </div>
          <div class="chat-body scrollbar">
            <div class="chat">
              <div class="message" v-for="message in clientMessages" v-if="message.sender == selectedUser._id || message.receiver == selectedUser._id"
                v-bind:class="[message.sender == client._id ? 'local': '']">
                <div class="text">{{message.text}}</div>
                <div class="timestamp">{{message.timestamp | momentTimestamp}}</div>
              </div>
            </div>
            <div class="splash-screen" v-if="selectedUser._id == undefined">
              <div class="app-name">Socialine</div>
              <div class="app-logo"></div>
            </div>
          </div>
          <div class="chat-input">
            <input class="textbox" v-model.trim="messageInput" v-on:keydown.enter="sendMessage" v-on:focus="scrollChatBody" :disabled="selectedUser._id == undefined"
              type="text" name="" id="messageInput" :placeholder="selectedUser._id == undefined ? 'Select a contact first...' : 'Write your message here...'">
            <button class="action-button" v-on:click="sendMessage" :disabled="selectedUser._id == undefined">
              <span>
                <i class="fas fa-location-arrow" data-fa-transform="rotate-45"></i>
              </span>
            </button>
          </div>
        </div>
      </div>
      <div class="log-panel" v-if="client == null">
        <div class="brand-line">
          <div class="app-logo"></div>
          <div class="app-name">Socialine</div>
        </div>
        <div class="log-table">
          <div class="log-selector-row">
            <button class="log-selector" v-bind:class="[selectedLogSelector == 'loginLog' ? 'selected': '']" v-on:click="selectedLogSelector = 'loginLog'">Log in</button>
            <button class="log-selector" v-bind:class="[selectedLogSelector == 'signupLog' ? 'selected': '']" v-on:click="selectedLogSelector = 'signupLog'">Sign up</button>
          </div>
          <div class="log-wrapper">
            <div id="loginLog" class="log login" v-bind:class="[selectedLogSelector == 'loginLog' ? 'visible': '']">
              <div class="row">
                <div class="label">Username</div>
                <input type="text" name="" id="loginUsername" v-model.trim="loginUsername" class="textbox">
              </div>
              <div class="row">
                <div class="label">Password</div>
                <input type="password" name="" id="loginPassword" v-model.trim="loginPassword" class="textbox">
              </div>
              <button class="action-button" v-on:click="login">Log In</button>
            </div>
            <div id="signupLog" class="log signup" v-bind:class="[selectedLogSelector == 'signupLog' ? 'visible': '']">
              <div class="row">
                <div class="label">Username</div>
                <input type="text" name="" id="signupUsername" v-model.trim="signupUsername" class="textbox">
                <div class="tip">This is the name of your account, you will use it to sign in. Nobody will see it.</div>
              </div>
              <div class="row">
                <div class="label">Password</div>
                <input type="password" name="" id="signupPassword" v-model.trim="signupPassword" class="textbox">
              </div>
              <div class="row">
                <div class="label">Confirm password</div>
                <input type="password" name="" id="signupConfirmPassword" v-model.trim="signupConfirmPassword" class="textbox">
              </div>
              <div class="row">
                <div class="label">Name</div>
                <input type="text" name="" id="signupName" v-model.trim="signupName" class="textbox">
                <div class="tip">This is the name other users will see. You can always change it.</div>
              </div>
              <button class="action-button" v-on:click="signUp">Sign up</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

<!--script>
  document.addEventListener("DOMContentLoaded", function (event) {
    console.log("DOM fully loaded and parsed");
  });
  window.addEventListener("load", function(event) {
    console.log("All resources finished loading!");
  });
</script-->

<script src="https://cdn.jsdelivr.net/npm/vue"></script>
<script src="//unpkg.com/@feathersjs/client@^3.0.0/dist/feathers.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.12.0/moment.js"></script>
<script defer src="https://use.fontawesome.com/releases/v5.0.2/js/all.js"></script>
<script src="client.js"></script>

</html>